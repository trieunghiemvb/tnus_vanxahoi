<?phpif (!defined('AREA')) {    die('Access denied');}?><link rel="stylesheet" href="<?php echo AppObject::getBaseFile('app/essay_check_condition/css/dataTables.bootstrap.css') ?>"><link rel="stylesheet" href="<?php echo AppObject::getBaseFile('app/essay_check_condition/css/style.css') ?>"><script src="<?php echo AppObject::getBaseFile('app/essay_check_condition/js/jquery.dataTables.min.js') ?>"></script><script src="<?php echo AppObject::getBaseFile('app/essay_check_condition/js/dataTables.bootstrap.js') ?>"></script><script src="<?php echo AppObject::getBaseFile('app/essay_check_condition/js/fnAddTr.js') ?>"></script><script src="<?php echo AppObject::getBaseFile('app/essay_check_condition/js/scripts.js') ?>"></script><script src="<?php echo AppObject::getBaseFile('app/essay_check_condition/js/jquery.mask.min.js') ?>"></script><script src="<?php echo AppObject::getBaseFile('app/essay_check_condition/js/jquery.download.js') ?>"></script><!-- hidden --><input type="hidden" name="split_type" id="split_type" value="0" /><!-- col-sm-4 --><div class="col-sm-2">    <div class="well">        <form class="form" role="form" id="form_filter" >            <div class="form-group" >                <label for="" class="control-label">Chọn khóa:</label>                <select name="sel_course" id="sel_course" class="form-control input-sm sel_filter">                    <option value="0">-Tất cả-</option>                    <?php                    foreach ($this->arr_course as $key => $value) {                        ?>                        <option value="<?= $key ?>"><?= $value ?></option>                    <?php } ?>                </select>            </div>            <div class="form-group" >                <label for="" class="control-label">Chọn ngành:</label>                <select name="sel_exam" id="sel_group_field" class="form-control input-sm sel_filter">                    <option value="0">- Tất cả -</option>                    <?php                    foreach ($this->arr_goup_field as $key => $value) {                        ?>                        <option value="<?= $key ?>"><?= $value ?></option>                    <?php } ?>                </select>            </div>            <div class="form-group" >                <label for="" class="control-label">Chọn lớp:</label>                <select id="sel_class" class="form-control input-sm">                    <option value="0">-Tất cả-</option>                </select>            </div>        </form>    </div>  </div><!-- col-sm-4 --><div class="col-sm-3"></div><!-- Danh sách chi tiết lớp --><div class="col-sm-10">    <div class="panel panel-primary">        <div class="panel-heading">            <h4>Danh sách sinh viên</h4>        </div>        <div class="panel-body">            <table id="tbl_list_student" class="table table-striped table-hover table-bordered">                <thead>                    <tr>                        <th>STT</th>                        <th>Mã học viên</th>                        <th>Họ và tên</th>                        <th>Ngày sinh</th>                        <th>Chuyên ngành</th>                        <th>Trạng thái</th>                        <th>Ghi chú</th>                    </tr>                </thead>                <tbody>                </tbody>            </table>            <!-- action table -->            <div class="well">                <table class="action_table table">                    <tbody>                        <tr align="right">                            <td>                                <button id="btn_check" class="btn btn-md btn-success"><i class="glyphicon glyphicon-align-justify"></i> Xét điều kiện</button> |                                 <button id="btn_save" class="btn btn-md btn-warning" ><i class="glyphicon glyphicon-floppy-disk"></i> Lưu kết quả </button>                            </td>                        </tr>                    </tbody>                </table>            </div>        </div>    </div></div><!-- Js app functions --><script type="text/javascript">    function load_page() {        validate_select();        disable("#sel_class");    }    function enable(item) {        $(item).prop('disabled', false);    }    function disable(item) {        $(item).prop('disabled', true);    }    function validate_select() {//        console.log("Running!");        var id_course = $("#sel_course").val();        var id_group_field = $("#sel_group_field").val();        var sel_class = $("#sel_class").val();        if (id_course == 0 || id_group_field == 0) {            disable("#sel_class");        } else {            load_class(id_course, id_group_field);        }    }</script><!-- Js Ajax --> <script type="text/javascript">    var ajaxUrl = "<?= AppObject::getBaseFile('app/essay_check_condition/helpers/ajax.php') ?>";    // Load class    function load_class(id_course, id_group_field) {        var str_post_data = id_course + ";" + id_group_field;        $.post(ajaxUrl, {act: 'load_class', str_post_data: str_post_data}, function (str_response_data) {            //console.log("str_response_data=" + str_response_data);            var data = $.parseJSON(str_response_data);            var str_data = data.returndata;            var row = str_data.split('#');            $('#sel_class').find('option:not(:first)').remove();            $.each(row, function (key, value) {                var tmp = value.split(';');                if (tmp[0] !== null && tmp[0] !== "") {                    $('#sel_class').append('<option value="' + tmp[0] + '">' + tmp[1] + '</option>');                }            });            enable("#sel_class");        });    }    // Load student    function load_student(id_class) {//        console.log("Running! id_class=" + id_class);        var str_post_data = id_class;        $.post(ajaxUrl, {act: 'load_student', str_post_data: str_post_data}, function (str_response_data) {            //console.log("str_response_data=" + str_response_data);            var data = $.parseJSON(str_response_data);            var str_data = data.returndata;            var row = str_data.split('#');            $('#tbl_list_student > tbody').html("");            var n = 0;            $.each(row, function (key, value) {                var tmp = value.split(';');                n++;                if (tmp[0] !== null && tmp[0] !== "") {                                        var stt = tmp[6]=='0'? "Chưa xét": tmp[6]=='1'? "Chưa đủ ĐK": "Đủ điều kiện";                    var r = "";                    r += "<tr>";                    r += "<td>" + n + "</td>";                    r += "<td>" + tmp[0] + "</td>";                    r += " <td>" + tmp[3] + " " + tmp[2] + "</td>";                    r += "<td>" + tmp[4] + "</td>";                    r += "<td>" + tmp[5] + "</td>";                    r += "<td id='stt_"+tmp[1]+"'>"+stt+"</td>";                    r += "<td id='note_"+tmp[1]+"'></td>";                    r += " </tr>";                    //console.log('row: '+ r);                    $('#tbl_list_student > tbody').append(r);                }            });        });    }    // Check Essay    function check_essay(id_class) {//        console.log("Running! id_class=" + id_class);        var str_post_data = id_class;        $.post(ajaxUrl, {act: 'check_condition', str_post_data: str_post_data}, function (str_response_data) {            //console.log("str_response_data=" + str_response_data);            var data = $.parseJSON(str_response_data);            var str_data = data.returndata;            var row = str_data.split('#');            $('#tbl_list_student > tbody').html("");            var n = 0;            $.each(row, function (key, value) {                var tmp = value.split(';');                n++;                if (tmp[0] !== null && tmp[0] !== "") {                    var r = "";                    var stt = tmp[6]=='0'? "Chưa đủ ĐK": "Đủ điều kiện";                    r += "<tr>";                    r += "<td class='label_" + tmp[6] + "'>" + n + "</td>";                    r += "<td class='label_" + tmp[6] + "'>" + tmp[0] + "</td>";                    r += " <td class='label_" + tmp[6] + "'>" + tmp[3] + " " + tmp[2] + "</td>";                    r += "<td class='label_" + tmp[6] + "'>" + tmp[4] + "</td>";                    r += "<td class='label_" + tmp[6] + "'>" + tmp[5] + "</td>";                    r += "<td class='label_" + tmp[6] + "' id='stt_"+tmp[1]+"'>" + stt + "</td>";                    r += "<td class='label_" + tmp[6] + "' id='note_"+tmp[1]+"'>" + tmp[7] + "</td>";                    r += " </tr>";                    //console.log('row: '+ r);                    $('#tbl_list_student > tbody').append(r);                }            });        });    }    // Save essay_condition    function save_condition(id_class) {        var str_post_data = id_class;        $.post(ajaxUrl, {act: 'save_condition', str_post_data: str_post_data}, function (str_response_data) {            //console.log("str_response_data=" + str_response_data);            load_student(id_class);        });    }</script><!-- Js Function already --> <script type="text/javascript">    (function () {        load_page();        // Select khóa        $('#form_filter').on('change', '#sel_course', function () {            validate_select();        });        // Select ngành        $('#form_filter').on('change', '#sel_group_field', function () {            validate_select();        });        // Select đợt thi        $('#form_filter').on('change', '#sel_class', function () {            var id_class = $("#sel_class").val();            if (id_class !== "0") {                load_student(id_class);            }        });        // Click xét điều kiện luận văn        $('.action_table').on('click', '#btn_check', function () {            var id_class = $("#sel_class").val();            if (id_class !== "0") {                check_essay(id_class);            }        });        // Click xét điều kiện luận văn        $('.action_table').on('click', '#btn_save', function () {            var id_class = $("#sel_class").val();            if (id_class !== "0") {                save_condition(id_class);            }        });    })(jQuery);</script>
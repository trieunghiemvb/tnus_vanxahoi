<?phpdefine('AREA', 'A');require '../../../init.php';require_once ('../exam_room.php');$act = isset($_POST['act']) ? substr(trim($_POST['act']), 0, 30) : "";switch ($act) {    case 'load_exam':        $str_data = isset($_POST['str_post_data']) ? trim($_POST['str_post_data']) : "";        $id_course = isset($str_data) ? intval($str_data) : "";        $status = "";        $message = "";        $str_returndata = "";        $arr_result = Exam_roomApp::get_select_table('examination', 'id', 'name', array('id_course' => $id_course));        foreach ($arr_result as $key => $value) {            $row = $key . ";" . $value;            $str_returndata.=$row . "#";        }        $str_returndata = rtrim($str_returndata, '#');        echo json_encode(array('status' => $status, 'message' => $message, 'returndata' => $str_returndata));        break;    case 'load_subject':        $str_data = isset($_POST['str_post_data']) ? trim($_POST['str_post_data']) : "";        $id_exam = isset($str_data) ? intval($str_data) : "";        $status = "";        $message = "";        $str_returndata = "";        $arr_result = Exam_roomApp::get_subject_by_id_exam($id_exam);        foreach ($arr_result as $key => $value) {            $row = $key . ";" . $value;            $str_returndata.=$row . "#";        }        $str_returndata = rtrim($str_returndata, '#');        echo json_encode(array('status' => $status, 'message' => $message, 'returndata' => $str_returndata));        break;    case 'load_building_room':        $str_data = isset($_POST['str_post_data']) ? trim($_POST['str_post_data']) : "";        $id_building = isset($str_data) ? intval($str_data) : "";        $status = "";        $message = "";        $str_returndata = "";        $arr_result = Exam_roomApp::get_building_room($id_building);        foreach ($arr_result as $key => $value) {            $row = $key . ";" . $value;            $str_returndata.=$row . "#";        }        $str_returndata = rtrim($str_returndata, '#');        echo json_encode(array('status' => $status, 'message' => $message, 'returndata' => $str_returndata));        break;    case 'load_exam_list':        $status = "";        $message = "";        $returndata = "";        $str_returndata = "";        $str_data = isset($_POST['str_post_data']) ? trim($_POST['str_post_data']) : "";        $arr_data = explode(";", $str_data);        $id_exam = isset($arr_data[0]) ? $arr_data[0] : "";        $id_subject = isset($arr_data[1]) ? $arr_data[1] : "";        $arr_result = Exam_roomApp::get_exam_list($id_exam, $id_subject);        foreach ($arr_result as $key => $value) {            $row = $key . ";" . $value;            $str_returndata.=$row . "#";        }        $str_returndata = rtrim($str_returndata, '#');        echo json_encode(array('status' => $status, 'message' => $message, 'returndata' => $str_returndata));        break;    case 'load_list_info':        $status = "";        $message = "";        $returndata = "";        $str_returndata = "";        $str_data = isset($_POST['str_post_data']) ? trim($_POST['str_post_data']) : "";        $arr_data = explode(";", $str_data);        $id_exam_list = isset($arr_data[0]) ? $arr_data[0] : "";        $arr_result = Exam_roomApp::get_exam_info($id_exam_list);        foreach ($arr_result as $key => $value) {            $row = $key . ";" . $value;            $str_returndata.=$row . "#";        }        $str_returndata = rtrim($str_returndata, '#');        echo json_encode(array('status' => $status, 'message' => $message, 'returndata' => $str_returndata));        break;    case 'load_room':        $status = "";        $message = "";        $returndata = "";        $str_returndata = "";        $str_data = isset($_POST['str_post_data']) ? trim($_POST['str_post_data']) : "";        $arr_data = explode(";", $str_data);        $id_exam_list = isset($arr_data[0]) ? $arr_data[0] : "";        $arr_result = Exam_roomApp::get_arr_room($id_exam_list);//        print_r($arr_result);        $str_room = "";        $num_room = 0;        foreach ($arr_result as $key => $arr_st) {            $num_room++;            $id_room = Exam_roomApp::get_exam_address($id_exam_list, $num_room);            $str_room .=$id_room . ";";            foreach ($arr_st as $item) {                $row = $item['id_student'] . ";" . $item['student_code'] . ";" . $item['last_name'] . ";" .                       $item['first_name'] . ";" . $item['birthday'] . ";" . $item['id_exam_list'];                $str_returndata.=$row . "#";            }            $str_returndata = rtrim($str_returndata, '#');            $str_returndata.="%";        }        $str_returndata = rtrim($str_returndata, '%');        //echo $str_returndata;        echo json_encode(array('status' => $status, 'message' => $message, 'returndata' => $str_returndata, 'room' => $str_room));        break;    case 'save_room':        $status = "";        $message = "";        $returndata = "";        $str_returndata = "";        $str_post_data = isset($_POST['str_post_data']) ? trim($_POST['str_post_data']) : "";        //echo "str_post_data=$str_post_data";        $arr_temp = explode("#", $str_post_data);        $arr_temp[1] = rtrim($arr_temp[1], ';');        $arr_data = explode(";", $arr_temp[1]);        $arr_temp[2] = rtrim($arr_temp[2], ';');        $arr_add = explode(";", $arr_temp[2]);        $id_exam_list = $arr_temp[0];        //echo "arr_data="; print_r($arr_data);//        echo "arr_add="; print_r($arr_add);        if (Exam_roomApp::save_room($id_exam_list, $arr_data,$arr_add)) {            $status = "success";            $message = "Lưu thành công!";        } else {            $status = "danger";            $message = "Lưu không thành công!";        }        echo json_encode(array('status' => $status, 'message' => $message, 'returndata' => $str_returndata));        break;}?>
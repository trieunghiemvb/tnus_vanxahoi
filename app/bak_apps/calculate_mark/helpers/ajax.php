<?phpdefine('AREA', 'A');require '../../../init.php';require_once ('../calculate_mark.php');$act = isset($_POST['act']) ? substr(trim($_POST['act']), 0, 50) : "";switch ($act) {    case 'load_year':        $status = "";        $message = "";        $returndata = "";        $arr_year = Calculate_markApp::get_select_year();        foreach ($arr_year as $item) {            $returndata.=$item . ";";        }        $returndata = rtrim($returndata, ';');        echo json_encode(array('status' => $status, 'messeage' => $message, 'returndata' => $returndata));        break;    case 'load_groupfield':        $status = "";        $message = "";        $returndata = "";        $year = isset($_POST['str_post_data']) ? trim($_POST['str_post_data']) : "";        $arr_groupfield = Calculate_markApp::get_sel_groupfield_by_year($year);        $str_groupfield = "";        foreach ($arr_groupfield as $key => $value) {            $row = $key . ";" . $value;            $str_groupfield.=$row . "#";        }        $str_groupfield = rtrim($str_groupfield, '#');        echo json_encode(array('status' => $status, 'messeage' => $message, 'returndata' => $str_groupfield));        break;    case 'load_cs':        $status = "";        $message = "";        $returndata = "";        $str_data = isset($_POST['str_post_data']) ? trim($_POST['str_post_data']) : "";        $arr_data = explode(";", $str_data);        $year = isset($arr_data[0]) ? $arr_data[0] : "";        $id_group_field = isset($arr_data[1]) ? $arr_data[1] : "";        $arr_class_subject = Calculate_markApp::get_sel_class_subject($year, $id_group_field);        $str_cs = "";        foreach ($arr_class_subject as $key => $value) {            $row = $key . ";" . $value;            $str_cs.=$row . "#";        }        $str_cs = rtrim($str_cs, '#');        echo json_encode(array('status' => $status, 'messeage' => $message, 'returndata' => $str_cs));        break;    case 'load_student':        $status = "";        $message = "";        $returndata = "";        $id_class_subject = isset($_POST['str_post_data']) ? trim($_POST['str_post_data']) : "";        //echo "id_class_subject=". $id_class_subject;        $arr_student = Calculate_markApp::get_student($id_class_subject);        //print_r($arr_student);        $str_student = "";        //print_r($arr_student);        foreach ($arr_student as $key => $value) {            $row = $key . ";" . $value["student_code"] . ";" . $value["name"] . ";" . $value["mark_formula"] . ";" . $value["mark_component"] . ";" . $value["mark_exam"] . ";" . $value["mark_sumary"];            $str_student.=$row . "#";        }        $str_student = rtrim($str_student, '#');        echo json_encode(array('status' => $status, 'messeage' => $message, 'returndata' => $str_student));        break;    case 'cal_mark':        $status = "";        $message = "";        $returndata = "";        $id_class_subject = isset($_POST['str_post_data']) ? trim($_POST['str_post_data']) : "";        if (Calculate_markApp::cal_mark_by_class_subject($id_class_subject)) {            $status = "success";            $message = "Tính điểm thành công!";        } else {            $status = "danger";            $message = "Có lỗi xảy ra trong quá trình tính điểm.";        }        echo json_encode(array('status' => $status, 'messeage' => $message, 'returndata' => $returndata));        break;    case 'load_cs_2':        $status = "";        $message = "";        $returndata = "";        $str_cs = "";        $str_data = isset($_POST['str_post_data']) ? trim($_POST['str_post_data']) : "";        $arr_data = explode(";", $str_data);        $id_course = isset($arr_data[0]) ? $arr_data[0] : "";        $term = isset($arr_data[1]) ? $arr_data[1] : "";        $arr_class_subject = Calculate_markApp::get_arr_class_subject_by_id_course_term($id_course, $term);        if ($arr_class_subject != null) {            foreach ($arr_class_subject as $class_subject) {                $row = $class_subject["code"] . ";" . $class_subject["name"];                $str_cs.=$row . "#";            }            $str_cs = rtrim($str_cs, '#');        } else {                    }        echo json_encode(array('status' => $status, 'messeage' => $message, 'returndata' => $str_cs));        break;    // Tính điểm theo khóa, học kỳ    case 'cal_mark_by_course_term':        $status = "";        $message = "";        $returndata = "";        $str_data = isset($_POST['str_post_data']) ? trim($_POST['str_post_data']) : "";        $arr_data = explode(";", $str_data);        $id_course = isset($arr_data[0]) ? $arr_data[0] : "";        $term = isset($arr_data[1]) ? $arr_data[1] : "";        if (Calculate_markApp::cal_mark_by_id_course_term($id_course, $term)) {            $status = "success";            $message = "Tính điểm thành công!";        } else {            $status = "danger";            $message = "Có lỗi xảy ra trong quá trình tính điểm.";        }        echo json_encode(array('status' => $status, 'messeage' => $message, 'returndata' => $returndata));        break;    case 'load_class':        $status = "";        $message = "";        $returndata = "";        $str_class = "";        $id_course = isset($_POST['str_post_data']) ? trim($_POST['str_post_data']) : "0";        $arr_class = Calculate_markApp::get_arr_class_by_id_course($id_course);        //print_r($arr_class);        if ($arr_class != null) {            foreach ($arr_class as $class) {                $row = $class["class_code"] . ";" . $class["class_name"];                $str_class.=$row . "#";            }            $str_class = rtrim($str_class, '#');        } else {                    }        echo json_encode(array('status' => $status, 'messeage' => $message, 'returndata' => $str_class));        break;    // Tải danh sách lớp trong collapse 3    case 'load_t3_class':        $status = "";        $message = "";        $returndata = "";        $str_returndata = "";        $str_data = isset($_POST['str_post_data']) ? trim($_POST['str_post_data']) : "";        $arr_data = explode(";", $str_data);        $id_course = isset($arr_data[0]) ? $arr_data[0] : "";        $id_group_field = isset($arr_data[1]) ? $arr_data[1] : "";        $arr_result = Calculate_markApp::get_select_table("class", "id", "class_name", array("id_course" => $id_course, "id_group_field" => $id_group_field));//        print_r($arr_result);        foreach ($arr_result as $key => $value) {            $row = $key . ";" . $value;            $str_returndata.=$row . "#";        }        $str_returndata = rtrim($str_returndata, '#');        echo json_encode(array('status' => $status, 'message' => $message, 'returndata' => $str_returndata));        break;    // Tải danh sách sinh viên    case 'load_t3_student':        $status = "";        $message = "";        $returndata = "";        $str_returndata = "";        $str_data = isset($_POST['str_post_data']) ? trim($_POST['str_post_data']) : "";        $arr_data = explode(";", $str_data);        $id_class = isset($arr_data[0]) ? $arr_data[0] : "";        $arr_result = Calculate_markApp::get_arr_student_by_class($id_class);//        print_r($arr_result);        foreach ($arr_result as $key => $value) {            $row = $value['student_code'] . ";" . $value['id'] . ";" . $value['first_name'] . ";" . $value['last_name'] . ";" .                    $value['birthday'] . ";" . $value['major_name']. ";" . $value['final_mark'];            $str_returndata.=$row . "#";        }        $str_returndata = rtrim($str_returndata, '#');        echo json_encode(array('status' => $status, 'message' => $message, 'returndata' => $str_returndata));        break;    // Tải danh sách sinh viên    case 'cal_t3_mark':        $status = "";        $message = "";        $returndata = "";        $str_returndata = "";        $str_data = isset($_POST['str_post_data']) ? trim($_POST['str_post_data']) : "";        $arr_data = explode(";", $str_data);        $id_class = isset($arr_data[0]) ? $arr_data[0] : "";        $arr_result = Calculate_markApp::get_arr_student_by_class($id_class);//        print_r($arr_result);        foreach ($arr_result as $key => $value) {            $mark = Calculate_markApp::get_mark_final($value['id']);            $row = $value['student_code'] . ";" . $value['id'] . ";" . $value['first_name'] . ";" . $value['last_name'] . ";" .                    $value['birthday'] . ";" . $value['major_name'] . ";" . $mark;            $str_returndata.=$row . "#";        }        $str_returndata = rtrim($str_returndata, '#');        echo json_encode(array('status' => $status, 'message' => $message, 'returndata' => $str_returndata));        break;    // Lưu điểm tổng kết    case 'save_t3_mark':        $status = "success";        $message = "Lưu thành công điểm tổng kết của lớp!";        $returndata = "";        $str_returndata = "";        $str_data = isset($_POST['str_post_data']) ? trim($_POST['str_post_data']) : "";        $arr_data = explode(";", $str_data);        $id_class = isset($arr_data[0]) ? $arr_data[0] : "";        $arr_result = Calculate_markApp::get_arr_student_by_class($id_class);//        print_r($arr_result);        foreach ($arr_result as $key => $value) {            Calculate_markApp::save_mark_final($value['id']);        }        echo json_encode(array('status' => $status, 'message' => $message, 'returndata' => $str_returndata));        break;    default: break;}?>